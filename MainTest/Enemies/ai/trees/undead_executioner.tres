[gd_resource type="BehaviorTree" load_steps=49 format=3 uid="uid://drfs5irx3u084"]

[ext_resource type="Script" path="res://demo/ai/tasks/get_first_in_group.gd" id="1_qvoto"]
[ext_resource type="Script" path="res://demo/ai/tasks/pursue.gd" id="2_x5xpu"]
[ext_resource type="Script" path="res://demo/ai/tasks/face_target.gd" id="3_i5tkq"]
[ext_resource type="Script" path="res://demo/ai/tasks/select_random_nearby_pos.gd" id="4_3wkyo"]

[sub_resource type="BlackboardPlan" id="BlackboardPlan_cc0db"]
var/speed/name = &"speed"
var/speed/type = 3
var/speed/value = 100.0
var/speed/hint = 1
var/speed/hint_string = "10,1000,10"
var/summon_cooldown/name = &"summon_cooldown"
var/summon_cooldown/type = 1
var/summon_cooldown/value = false
var/summon_cooldown/hint = 0
var/summon_cooldown/hint_string = ""

[sub_resource type="BTConsolePrint" id="BTConsolePrint_psjkf"]
text = "Pause"

[sub_resource type="BBNode" id="BBNode_n5pg4"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_3ox1h"]
animation_player = SubResource("BBNode_n5pg4")
animation_name = &"Idle"
blend = 0.1

[sub_resource type="BTRandomWait" id="BTRandomWait_a2frv"]
min_duration = 0.4
max_duration = 0.6

[sub_resource type="BTSequence" id="BTSequence_arw5k"]
custom_name = "Pause before action"
children = [SubResource("BTConsolePrint_psjkf"), SubResource("BTPlayAnimation_3ox1h"), SubResource("BTRandomWait_a2frv")]

[sub_resource type="BTConsolePrint" id="BTConsolePrint_0b6pv"]
text = "Chase"

[sub_resource type="BBNode" id="BBNode_8ens0"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_rnwm0"]
animation_player = SubResource("BBNode_8ens0")
animation_name = &"Idle"
blend = 0.1

[sub_resource type="BTAction" id="BTAction_jqn6i"]
script = ExtResource("1_qvoto")
group = &"Player"
output_var = &"target"

[sub_resource type="BTAction" id="BTAction_80m8w"]
script = ExtResource("2_x5xpu")
target_var = &"target"
speed_var = &"speed"
approach_distance = -10.0

[sub_resource type="BTTimeLimit" id="BTTimeLimit_2t7ve"]
time_limit = 3.0
children = [SubResource("BTAction_80m8w")]

[sub_resource type="BTAction" id="BTAction_q2whv"]
script = ExtResource("3_i5tkq")
target_var = &"target"

[sub_resource type="BTWait" id="BTWait_p0gqt"]
duration = 0.1

[sub_resource type="BBNode" id="BBNode_niit4"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_t7qqb"]
await_completion = 1.0
animation_player = SubResource("BBNode_niit4")
animation_name = &"Skill1"

[sub_resource type="BTSequence" id="BTSequence_imbeq"]
custom_name = "Skill1"
children = [SubResource("BTConsolePrint_0b6pv"), SubResource("BTPlayAnimation_rnwm0"), SubResource("BTAction_jqn6i"), SubResource("BTTimeLimit_2t7ve"), SubResource("BTAction_q2whv"), SubResource("BTWait_p0gqt"), SubResource("BTPlayAnimation_t7qqb")]

[sub_resource type="BTConsolePrint" id="BTConsolePrint_vbroy"]
text = "Chase"

[sub_resource type="BBNode" id="BBNode_n3b0s"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_wyt4w"]
animation_player = SubResource("BBNode_n3b0s")
animation_name = &"Idle"
blend = 0.1

[sub_resource type="BTAction" id="BTAction_qmol7"]
script = ExtResource("1_qvoto")
group = &"Player"
output_var = &"target"

[sub_resource type="BTAction" id="BTAction_tpgc2"]
script = ExtResource("2_x5xpu")
target_var = &"target"
speed_var = &"speed"
approach_distance = 0.0

[sub_resource type="BTTimeLimit" id="BTTimeLimit_fy6d0"]
time_limit = 3.0
children = [SubResource("BTAction_tpgc2")]

[sub_resource type="BTAction" id="BTAction_y611e"]
script = ExtResource("3_i5tkq")
target_var = &"target"

[sub_resource type="BTWait" id="BTWait_b6i3w"]
duration = 0.1

[sub_resource type="BBNode" id="BBNode_0pu6a"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_pg2rb"]
await_completion = 1.0
animation_player = SubResource("BBNode_0pu6a")
animation_name = &"Attacking"

[sub_resource type="BTSequence" id="BTSequence_7cx58"]
custom_name = "Attack"
children = [SubResource("BTConsolePrint_vbroy"), SubResource("BTPlayAnimation_wyt4w"), SubResource("BTAction_qmol7"), SubResource("BTTimeLimit_fy6d0"), SubResource("BTAction_y611e"), SubResource("BTWait_b6i3w"), SubResource("BTPlayAnimation_pg2rb")]
metadata/_weight_ = 1.0

[sub_resource type="BTProbabilitySelector" id="BTProbabilitySelector_58fvk"]
children = [SubResource("BTSequence_imbeq"), SubResource("BTSequence_7cx58")]

[sub_resource type="BTConsolePrint" id="BTConsolePrint_7x0x2"]
text = "Summon"

[sub_resource type="BTComment" id="BTComment_q4slp"]
custom_name = "Variable $summon_cooldown is updated by the Cooldown task below"

[sub_resource type="BBVariant" id="BBVariant_u7l0h"]
type = 1
saved_value = false
resource_name = "false"

[sub_resource type="BTCheckVar" id="BTCheckVar_kpf7k"]
variable = &"summon_cooldown"
value = SubResource("BBVariant_u7l0h")
children = [SubResource("BTComment_q4slp")]

[sub_resource type="BBNode" id="BBNode_0m3rb"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_p8ut0"]
animation_player = SubResource("BBNode_0m3rb")
animation_name = &"Summon"
blend = 0.1

[sub_resource type="BTWait" id="BTWait_ol45g"]
duration = 0.5

[sub_resource type="BTAction" id="BTAction_p2q8d"]
script = ExtResource("4_3wkyo")
range_min = 10.0
range_max = 25.0
position_var = &"minion_pos"

[sub_resource type="BBVariant" id="BBVariant_wfjwy"]
type = 5
value_source = 1
variable = &"minion_pos"
resource_name = "$minion_pos"

[sub_resource type="BBNode" id="BBNode_tjxpm"]
saved_value = NodePath(".")
resource_name = "."

[sub_resource type="BTCallMethod" id="BTCallMethod_p8j7u"]
node = SubResource("BBNode_tjxpm")
method = &"summon_minion"
args = Array[BBVariant]([SubResource("BBVariant_wfjwy")])

[sub_resource type="BTCooldown" id="BTCooldown_4fpio"]
duration = 6.0
cooldown_state_var = &"summon_cooldown"
children = [SubResource("BTCallMethod_p8j7u")]

[sub_resource type="BTWait" id="BTWait_mabsf"]

[sub_resource type="BTSequence" id="BTSequence_0p4gj"]
custom_name = "Summon minion"
children = [SubResource("BTConsolePrint_7x0x2"), SubResource("BTCheckVar_kpf7k"), SubResource("BTPlayAnimation_p8ut0"), SubResource("BTWait_ol45g"), SubResource("BTAction_p2q8d"), SubResource("BTCooldown_4fpio"), SubResource("BTWait_mabsf")]

[sub_resource type="BTSequence" id="BTSequence_o500g"]
custom_name = "Main"
children = [SubResource("BTSequence_arw5k"), SubResource("BTProbabilitySelector_58fvk"), SubResource("BTSequence_0p4gj")]

[resource]
blackboard_plan = SubResource("BlackboardPlan_cc0db")
root_task = SubResource("BTSequence_o500g")
